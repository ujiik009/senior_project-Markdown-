<!DOCTYPE html>
<html>
<head>
	<title></title>
	<link rel="stylesheet" type="text/css" href="lib/css/bootstrap.min.css"/>
	<style type="text/css">
		.col-md-6{
			padding: 5px;
			/*background-color: #c0c2e5;*/
			height: auto;
		}
		.box{
			padding: 5px;
			height: auto;
			background-color:#70a9d1;

		}
		.io{ 
			padding: 20px;
			width: 100%;
			height: 41vw;
			background-color: #ffffff;
			overflow: scroll;
		}
		hr { 
		    display: block;
		    margin-top: 0.5em;
		    margin-bottom: 0.5em;
		    margin-left: auto;
		    margin-right: auto;
		    border-style: inset;
		    border-width: 1px;
		} 
		pre{
			width: auto;
			height: auto;
			background-color: #333;

		}
		code{
			height: inherit

		}

	</style>
</head>
<body>
<h1>Markdown</h1>

<button>ok</button>
<div class="row">
  <div class="col-md-6">
  	<div class="box">
  		<textarea class="input io"></textarea>
  	</div>
  </div>
  <div class="col-md-6">
  	<div class="box">
  		<div class="output io"></div>
  	</div>
  </div>
</div>
</body>
<script type="text/javascript" src="lib/js/jquery-3.1.1.js"></script>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/agate.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
<script type="text/javascript">
$( document ).ready(function() {
	hljs.initHighlightingOnLoad();
	$(".input").keyup(function(){
		
		$(".output").html(regexMD_to_html($(".input").val())),highlight();
	});
	var html;
	var template = "<html><meta charset='utf-8'><head></head><body><??content??></body></html>";
	function regexMD_to_html(text){
		
		var objpatt = {
			 pattH1 		: /(#{1})(.+)?/gm,
			 pattH2 		: /(#{2})(.+)?/gm,
			 pattH3 		: /(#{3})(.+)?/gm,
			 pattH4 		: /(#{4})(.+)?/gm,
			 pattH5 		: /(#{5})(.+)?/gm,
			 pattH6 		: /(#{6})(.+)?/gm,
			 pattheadder1	: /([A-z0-9ก-๙]+)\n={2,}/gm,
			 pattheadder2	: /([A-z0-9ก-๙]+)\n\-{2,}/gm,
			 pattlink 		: /(\[(.*?)\]\()(.+?)(\))/gm,
			 patthorizontal : /-{100,}/gm,
			 pattnewline 	: /^\n/mg,
			 pattStrong 	: /(\*\*|__)(.*?)\1/gm,
			 pattitalics 	: /(\*\*\*|___|\/\/\/)(.*?)\1/gm,
			 pattimgOption 	: /!\[(.*)\]\((.+)\)\((.+)\)\((.+)\)/gm,
			 pattimg 		: /!\[(.*)\]\((.+)\)/gm,
			 patttlist      : /\* (.*)/gm,
			 pattcode_block : /```(\w+)*\n([\s\S]*?)\n```/g,
			 pattTableth	: /[|][|](\s+[A-Za-z0-9 -_*#@$%:;?!.,\/\\]+\s+)[|]?[|]?(\s+[A-Za-z0-9 -_*#@$%:;?!.,\/\\]+\s+)[|]?[|]?(\s+[A-Za-z0-9 -_*#@$%:;?!.,\/\\]+\s+)[|]?[|]?\r?\n?\|?:-+:\|?:-+:\|?:-+:\|?/gm,
			 pattTableC 	: /[|](\s+[A-Za-z0-9 -_*#@$%:;?!.,\/\\]+\s+)[|](\s+[A-Za-z0-9 -_*#@$%:;?!.,\/\\]+\s+)[|](\s+[A-Za-z0-9 -_*#@$%:;?!.,\/\\]+\s+)[|]?\r?\n?/gm
			 
			
		}
		// text = text.match(pattH1);
		text = 
		text.replace(objpatt.pattTableth,"<table border=1>\n<tr>\n\t<th>$1</th>\n\t<th>$2</th>\n\t<th>$3</th>\n</tr>")
			.replace(objpatt.pattTableC,"\n<tr>\n\t<td>$1</td>\n\t<td>$2</td>\n\t<td>$3</td>\n</tr>")
			.replace(objpatt.pattnewline,"</br>")
			.replace(objpatt.pattH6,"<h6>\n\t$2\n</h6>\n")
			.replace(objpatt.pattH5,"<h5>\n\t$2\n</h5>\n")
			.replace(objpatt.pattH4,"<h4>\n\t$2\n</h4>\n")
			.replace(objpatt.pattH3,"<h3>\n\t$2\n</h3>\n")
			.replace(objpatt.pattH2,"<h2>\n\t$2\n</h2>\n")
			.replace(objpatt.pattH1,"<h1>\n\t$2\n</h1>\n")
			.replace(objpatt.pattheadder1,"<h1>$1</h1>")
			.replace(objpatt.pattheadder2,"<h2>$1</h2>")
			.replace(objpatt.patthorizontal,"<hr />")
			.replace(objpatt.pattitalics,"<em>$2</em>")
			.replace(objpatt.pattStrong,"<strong>$2</strong>")
			.replace(objpatt.pattimgOption,'<img src="$2" alt="$1" style="width:$3px;height:$4px;"/>')
			.replace(objpatt.pattimg,'<img src="$2" alt="$1" />')
			.replace(objpatt.pattlink,"<a href='$3'>$2</a>")
			.replace(objpatt.patttlist,"<ul><li>$1</li></ul>")
			.replace(objpatt.pattcode_block,"<pre><code class ='$1'>$2</code></pre>")

			
		html = text;
			
		//return text;
		//console.log(template.replace("<??content??>",text));
		//alert(template.replace("<??content??>",text));
		return template.replace("<??content??>",text);
	}
	function highlight(){
		$('pre code').each(function(i, block) {
		    hljs.highlightBlock(block);
		});
	}

	$("button").click(function(){
		alert(html);
	})

});
</script>

</html>




